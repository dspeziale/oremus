{% extends "base.html" %}

{% block title %}{{ data_fmt }} - Oremus{% endblock %}

{% block content %}

<!-- DATE NAVIGATION -->
<div class="date-nav">
    <a href="/day/{{ prev_date }}" class="btn btn-nav">
        <i class="fas fa-chevron-left"></i> Ieri
    </a>
    <div class="date-display">
        <i class="fas fa-calendar-alt me-2"></i>{{ data_fmt }}
    </div>
    <a href="/day/{{ next_date }}" class="btn btn-nav">
        Domani <i class="fas fa-chevron-right"></i>
    </a>
</div>

{% if not has_data %}
<div class="alert alert-warning" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Nessun dato</strong> per questa data. Esegui: <code>python orchestrate.py {{ data }}</code>
</div>
{% endif %}

<!-- TABS -->
<ul class="nav nav-tabs" role="tablist">
    {% if santo %}
    <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#santo" type="button">
            <i class="fas fa-cross me-2"></i>Santo
        </button>
    </li>
    {% endif %}

    {% if lodi %}
    <li class="nav-item">
        <button class="nav-link {% if not santo %}active{% endif %}" data-bs-toggle="tab" data-bs-target="#lodi" type="button">
            <i class="fas fa-sun me-2"></i>Lodi
        </button>
    </li>
    {% endif %}

    {% if vespri %}
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#vespri" type="button">
            <i class="fas fa-moon me-2"></i>Vespri
        </button>
    </li>
    {% endif %}

    {% if liturgia %}
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#liturgia" type="button">
            <i class="fas fa-book me-2"></i>Liturgia
        </button>
    </li>
    {% endif %}
</ul>

<!-- CONTENT -->
<div class="tab-content">

    <!-- SANTO TAB -->
    {% if santo %}
    <div class="tab-pane fade show active" id="santo">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-cross"></i>
                <h5>Santo del Giorno</h5>
            </div>
            <div class="card-body">
                {% if santo.principale %}
                <div class="santo-card">
                    <p class="santo-principale">{{ santo.principale }}</p>
                </div>
                {% endif %}

                {% if santo.commemorati %}
                <h5 class="section-title">
                    <i class="fas fa-users"></i> Commemorazioni
                </h5>

                {% for c in santo.commemorati %}
                <div class="commemorato-item">
                    {% if c.nome %}
                    <div class="commemorato-nome">
                        <i class="fas fa-star"></i> {{ c.nome }}
                    </div>
                    {% endif %}
                    {% if c.martirologio %}
                    <div class="commemorato-martirologio">
                        {{ c.martirologio }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- LODI TAB -->
    {% if lodi %}
    <div class="tab-pane fade {% if not santo %}show active{% endif %}" id="lodi">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-sun"></i>
                <h5>Lodi Mattutine</h5>
            </div>
            <div class="card-body">

                {% if lodi.introduzione %}
                <h5 class="section-title"><i class="fas fa-prayer-beads"></i> Introduzione</h5>
                <div class="text-section">{{ lodi.introduzione }}</div>
                {% endif %}

                {% if lodi.inno %}
                <h5 class="section-title"><i class="fas fa-music"></i> Inno</h5>
                <div class="text-section">{{ lodi.inno }}</div>
                {% endif %}

                {% if lodi.salmodia %}
                <h5 class="section-title"><i class="fas fa-book-open"></i> Salmodia</h5>
                {% for salmo in lodi.salmodia %}
                <div class="salmo-card">
                    <div class="salmo-header">
                        <i class="fas fa-scroll me-2"></i>Salmo {{ salmo.numero }}: {{ salmo.titolo }}
                    </div>
                    <div class="salmo-body">
                        {% if salmo.antifona_inizio %}
                        <div class="antifona">
                            <strong>Antifona:</strong> {{ salmo.antifona_inizio }}
                        </div>
                        {% endif %}
                        <div class="text-section">{{ salmo.testo }}</div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}

                {% if lodi.lettura_breve %}
                <h5 class="section-title"><i class="fas fa-bookmark"></i> Lettura Breve</h5>
                {% if lodi.lettura_breve.riferimento %}
                <p class="biblia-ref">{{ lodi.lettura_breve.riferimento }}</p>
                {% endif %}
                <div class="text-section">{{ lodi.lettura_breve.testo }}</div>
                {% endif %}

                {% if lodi.responsorio_breve %}
                <h5 class="section-title"><i class="fas fa-reply"></i> Responsorio</h5>
                <div class="text-section">{{ lodi.responsorio_breve }}</div>
                {% endif %}

                {% if lodi.cantico %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Cantico del Benedictus</h5>
                <div class="salmo-card">
                    <div class="salmo-header">Lc 1, 68-79</div>
                    <div class="salmo-body">
                        <div class="text-section">{{ lodi.cantico.testo }}</div>
                        {% if lodi.cantico.dossologia %}
                        <div class="dossologia">{{ lodi.cantico.dossologia }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {% if lodi.orazione %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Orazione</h5>
                <div class="text-section">{{ lodi.orazione }}</div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- VESPRI TAB -->
    {% if vespri %}
    <div class="tab-pane fade" id="vespri">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-moon"></i>
                <h5>Vespri</h5>
            </div>
            <div class="card-body">

                {% if vespri.introduzione %}
                <h5 class="section-title"><i class="fas fa-prayer-beads"></i> Introduzione</h5>
                <div class="text-section">{{ vespri.introduzione }}</div>
                {% endif %}

                {% if vespri.inno %}
                <h5 class="section-title"><i class="fas fa-music"></i> Inno</h5>
                <div class="text-section">{{ vespri.inno }}</div>
                {% endif %}

                {% if vespri.salmodia %}
                <h5 class="section-title"><i class="fas fa-book-open"></i> Salmodia</h5>
                {% for salmo in vespri.salmodia %}
                <div class="salmo-card">
                    <div class="salmo-header">
                        <i class="fas fa-scroll me-2"></i>Salmo {{ salmo.numero }}: {{ salmo.titolo }}
                    </div>
                    <div class="salmo-body">
                        {% if salmo.antifona_inizio %}
                        <div class="antifona">
                            <strong>Antifona:</strong> {{ salmo.antifona_inizio }}
                        </div>
                        {% endif %}
                        <div class="text-section">{{ salmo.testo }}</div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}

                {% if vespri.lettura_breve %}
                <h5 class="section-title"><i class="fas fa-bookmark"></i> Lettura Breve</h5>
                {% if vespri.lettura_breve.riferimento %}
                <p class="biblia-ref">{{ vespri.lettura_breve.riferimento }}</p>
                {% endif %}
                <div class="text-section">{{ vespri.lettura_breve.testo }}</div>
                {% endif %}

                {% if vespri.responsorio_breve %}
                <h5 class="section-title"><i class="fas fa-reply"></i> Responsorio</h5>
                <div class="text-section">{{ vespri.responsorio_breve }}</div>
                {% endif %}

                {% if vespri.magnificat %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Cantico del Magnificat</h5>
                <div class="salmo-card">
                    <div class="salmo-header">
                        {% if vespri.magnificat.riferimento %}{{ vespri.magnificat.riferimento }}{% else %}Lc 1, 46-55{% endif %}
                    </div>
                    <div class="salmo-body">
                        {% if vespri.magnificat.sottotitolo %}
                        <p style="font-style: italic; color: #6366f1; margin-bottom: 1rem;">
                            {{ vespri.magnificat.sottotitolo }}
                        </p>
                        {% endif %}
                        <div class="text-section">{{ vespri.magnificat.testo }}</div>
                        {% if vespri.magnificat.dossologia %}
                        <div class="dossologia">{{ vespri.magnificat.dossologia }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {% if vespri.orazione %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Orazione</h5>
                <div class="text-section">{{ vespri.orazione }}</div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- LITURGIA TAB -->
    {% if liturgia %}
    <div class="tab-pane fade" id="liturgia">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-book"></i>
                <h5>Liturgia del Giorno</h5>
            </div>
            <div class="card-body">
                {% for lettura in liturgia.letture %}
                <h5 class="section-title">
                    {% if 'LETTURA' in lettura.tipo %}
                    <i class="fas fa-scroll"></i>
                    {% elif 'SALMO' in lettura.tipo %}
                    <i class="fas fa-music"></i>
                    {% elif 'VANGELO' in lettura.tipo %}
                    <i class="fas fa-book-open"></i>
                    {% else %}
                    <i class="fas fa-bookmark"></i>
                    {% endif %}
                    {{ lettura.tipo }}
                </h5>
                {% if lettura.riferimento %}
                <p class="biblia-ref">{{ lettura.riferimento }}</p>
                {% endif %}
                <div class="text-section">{{ lettura.testo }}</div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

</div>

{% endblock %}