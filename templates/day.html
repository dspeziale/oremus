{% extends "base.html" %}

{% block title %}{{ data_fmt }} - Oremus{% endblock %}

{% block content %}

<!-- TABS NAVIGATION -->
{% if santo or lodi or vespri or liturgia %}
<ul class="nav nav-tabs" role="tablist">
    {% if santo %}
    <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#santo" type="button">
            <i class="fas fa-cross me-2"></i>Santo
        </button>
    </li>
    {% endif %}

    {% if lodi %}
    <li class="nav-item">
        <button class="nav-link {% if not santo %}active{% endif %}" data-bs-toggle="tab" data-bs-target="#lodi" type="button">
            <i class="fas fa-sun me-2"></i>Lodi Mattutine
        </button>
    </li>
    {% endif %}

    {% if vespri %}
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#vespri" type="button">
            <i class="fas fa-moon me-2"></i>Vespri
        </button>
    </li>
    {% endif %}

    {% if liturgia %}
    <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#liturgia" type="button">
            <i class="fas fa-book me-2"></i>Liturgia del Giorno
        </button>
    </li>
    {% endif %}
</ul>
{% else %}
<div class="alert alert-warning" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Nessun dato</strong> per questa data. Esegui: <code>python orchestrate.py {{ data }}</code>
</div>
{% endif %}

<!-- CONTENT TABS -->
<div class="tab-content">

    <!-- ============================================================================
         SANTO TAB
         ============================================================================ -->
    {% if santo %}
    <div class="tab-pane fade show active" id="santo">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-cross"></i>
                <h5>Santo del Giorno</h5>
            </div>
            <div class="card-body">
                {% if santo.principale %}
                <div class="santo-card">
                    <p class="santo-principale">{{ santo.principale }}</p>
                </div>
                {% endif %}

                {% if santo.commemorati %}
                <h5 class="section-title">
                    <i class="fas fa-users"></i> Commemorazioni
                </h5>

                {% for c in santo.commemorati %}
                <div class="commemorato-item">
                    {% if c.nome %}
                    <div class="commemorato-nome">
                        <i class="fas fa-star"></i> {{ c.nome }}
                    </div>
                    {% endif %}
                    {% if c.martirologio %}
                    <div class="commemorato-martirologio">
                        {{ c.martirologio }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}

                <p style="margin-top: 2rem; color: var(--neutral-600); font-size: 0.9em;">
                    <i class="fas fa-info-circle me-1"></i>
                    <strong>Fonte:</strong> Chiesa Cattolica Italiana
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ============================================================================
         LODI MATTUTINE TAB
         ============================================================================ -->
    {% if lodi %}
    <div class="tab-pane fade {% if not santo %}show active{% endif %}" id="lodi">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-sun"></i>
                <h5>Lodi Mattutine</h5>
            </div>
            <div class="card-body">

                <!-- INTRODUZIONE -->
                {% if lodi.introduzione %}
                <h5 class="section-title"><i class="fas fa-prayer-beads"></i> Introduzione</h5>
                <div class="text-section">{{ lodi.introduzione }}</div>
                {% endif %}

                <!-- INNO -->
                {% if lodi.inno %}
                <h5 class="section-title"><i class="fas fa-music"></i> Inno</h5>
                <div class="text-section">{{ lodi.inno }}</div>
                {% endif %}

                <!-- SALMODIA - CORRETTA -->
                {% if lodi.salmodia %}
                <h5 class="section-title"><i class="fas fa-book-open"></i> Salmodia (3 Salmi)</h5>

                {% for salmo in lodi.salmodia %}
                <div class="salmo-card">
                    <!-- HEADER CON NUMERO E TITOLO -->
                    <div class="salmo-header">
                        <i class="fas fa-scroll me-2"></i>
                        <strong>Salmo {{ salmo.numero }}</strong>
                        {% if salmo.titolo %}
                            <span class="salmo-subtitle">{{ salmo.titolo }}</span>
                        {% endif %}
                    </div>

                    <!-- BODY DEL SALMO -->
                    <div class="salmo-body">
                        <!-- ANTIFONA INIZIALE - SEPARATA -->
                        {% if salmo.antifona_inizio %}
                        <div class="antifona-container">
                            <div class="antifona-label">
                                <i class="fas fa-quote-left"></i> Antifona
                            </div>
                            <div class="antifona">
                                {{ salmo.antifona_inizio }}
                            </div>
                        </div>
                        {% endif %}

                        <!-- TESTO DEL SALMO - SEPARATO -->
                        {% if salmo.testo %}
                        <div class="salmo-testo">
                            {{ salmo.testo }}
                        </div>
                        {% endif %}

                        <!-- GLORIA AL PADRE - SE PRESENTE -->
                        <div class="gloria-patris">
                            Gloria al Padre e al Figlio<br>
                            e allo Spirito Santo.<br>
                            Come era nel principio, e ora e sempre<br>
                            nei secoli dei secoli. Amen.
                        </div>
                    </div>
                </div>
                {% endfor %}

                {% endif %}

                <!-- LETTURA BREVE -->
                {% if lodi.lettura_breve %}
                <h5 class="section-title"><i class="fas fa-bookmark"></i> Lettura Breve</h5>
                {% if lodi.lettura_breve.riferimento %}
                <p class="biblia-ref">{{ lodi.lettura_breve.riferimento }}</p>
                {% endif %}
                <div class="text-section">{{ lodi.lettura_breve.testo }}</div>
                {% endif %}

                <!-- RESPONSORIO BREVE -->
                {% if lodi.responsorio_breve %}
                <h5 class="section-title"><i class="fas fa-reply"></i> Responsorio Breve</h5>
                <div class="text-section responsorio">{{ lodi.responsorio_breve }}</div>
                {% endif %}

                <!-- CANTICO DEL BENEDICTUS -->
                {% if lodi.cantico %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Cantico del Benedictus</h5>
                <div class="salmo-card cantico-card">
                    <div class="salmo-header">
                        <i class="fas fa-heart me-2"></i> Lc 1, 68-79
                    </div>
                    <div class="salmo-body">
                        <div class="salmo-testo">{{ lodi.cantico.testo }}</div>
                        {% if lodi.cantico.dossologia %}
                        <div class="gloria-patris">{{ lodi.cantico.dossologia }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- ORAZIONE -->
                {% if lodi.orazione %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Orazione</h5>
                <div class="text-section orazione">{{ lodi.orazione }}</div>
                {% endif %}

            </div>
        </div>
    </div>
    {% endif %}

    <!-- ============================================================================
         VESPRI TAB
         ============================================================================ -->
    {% if vespri %}
    <div class="tab-pane fade" id="vespri">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-moon"></i>
                <h5>Vespri</h5>
            </div>
            <div class="card-body">

                <!-- INTRODUZIONE -->
                {% if vespri.introduzione %}
                <h5 class="section-title"><i class="fas fa-prayer-beads"></i> Introduzione</h5>
                <div class="text-section">{{ vespri.introduzione }}</div>
                {% endif %}

                <!-- INNO -->
                {% if vespri.inno %}
                <h5 class="section-title"><i class="fas fa-music"></i> Inno</h5>
                <div class="text-section">{{ vespri.inno }}</div>
                {% endif %}

                <!-- SALMODIA - CORRETTA -->
                {% if vespri.salmodia %}
                <h5 class="section-title"><i class="fas fa-book-open"></i> Salmodia (3 Salmi)</h5>

                {% for salmo in vespri.salmodia %}
                <div class="salmo-card">
                    <!-- HEADER CON NUMERO E TITOLO -->
                    <div class="salmo-header">
                        <i class="fas fa-scroll me-2"></i>
                        <strong>Salmo {{ salmo.numero }}</strong>
                        {% if salmo.titolo %}
                            <span class="salmo-subtitle">{{ salmo.titolo }}</span>
                        {% endif %}
                    </div>

                    <!-- BODY DEL SALMO -->
                    <div class="salmo-body">
                        <!-- ANTIFONA INIZIALE - SEPARATA -->
                        {% if salmo.antifona_inizio %}
                        <div class="antifona-container">
                            <div class="antifona-label">
                                <i class="fas fa-quote-left"></i> Antifona
                            </div>
                            <div class="antifona">
                                {{ salmo.antifona_inizio }}
                            </div>
                        </div>
                        {% endif %}

                        <!-- TESTO DEL SALMO - SEPARATO -->
                        {% if salmo.testo %}
                        <div class="salmo-testo">
                            {{ salmo.testo }}
                        </div>
                        {% endif %}

                        <!-- GLORIA AL PADRE -->
                        <div class="gloria-patris">
                            Gloria al Padre e al Figlio<br>
                            e allo Spirito Santo.<br>
                            Come era nel principio, e ora e sempre<br>
                            nei secoli dei secoli. Amen.
                        </div>
                    </div>
                </div>
                {% endfor %}

                {% endif %}

                <!-- LETTURA BREVE -->
                {% if vespri.lettura_breve %}
                <h5 class="section-title"><i class="fas fa-bookmark"></i> Lettura Breve</h5>
                {% if vespri.lettura_breve.riferimento %}
                <p class="biblia-ref">{{ vespri.lettura_breve.riferimento }}</p>
                {% endif %}
                <div class="text-section">{{ vespri.lettura_breve.testo }}</div>
                {% endif %}

                <!-- RESPONSORIO BREVE -->
                {% if vespri.responsorio_breve %}
                <h5 class="section-title"><i class="fas fa-reply"></i> Responsorio Breve</h5>
                <div class="text-section responsorio">{{ vespri.responsorio_breve }}</div>
                {% endif %}

                <!-- CANTICO DEL MAGNIFICAT -->
                {% if vespri.magnificat %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Cantico del Magnificat</h5>
                <div class="salmo-card cantico-card">
                    <div class="salmo-header">
                        <i class="fas fa-heart me-2"></i>
                        {% if vespri.magnificat.riferimento %}
                            {{ vespri.magnificat.riferimento }}
                        {% else %}
                            Lc 1, 46-55
                        {% endif %}
                    </div>
                    <div class="salmo-body">
                        {% if vespri.magnificat.sottotitolo %}
                        <p class="magnificat-subtitle">
                            {{ vespri.magnificat.sottotitolo }}
                        </p>
                        {% endif %}

                        <div class="salmo-testo">
                            {{ vespri.magnificat.testo }}
                        </div>

                        {% if vespri.magnificat.dossologia %}
                        <div class="gloria-patris">
                            {{ vespri.magnificat.dossologia }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- ORAZIONE -->
                {% if vespri.orazione %}
                <h5 class="section-title"><i class="fas fa-hands-praying"></i> Orazione</h5>
                <div class="text-section orazione">{{ vespri.orazione }}</div>
                {% endif %}

            </div>
        </div>
    </div>
    {% endif %}

    <!-- ============================================================================
         LITURGIA DEL GIORNO TAB
         ============================================================================ -->
    {% if liturgia %}
    <div class="tab-pane fade" id="liturgia">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-book"></i>
                <h5>Liturgia del Giorno</h5>
            </div>
            <div class="card-body">
                {% if liturgia.letture %}
                    {% for lettura in liturgia.letture %}
                    <h5 class="section-title">
                        {% if 'PRIMA' in lettura.tipo.upper() %}
                            <i class="fas fa-scroll"></i> Prima Lettura
                        {% elif 'SECONDA' in lettura.tipo.upper() %}
                            <i class="fas fa-scroll"></i> Seconda Lettura
                        {% elif 'SALMO' in lettura.tipo.upper() %}
                            <i class="fas fa-music"></i> Salmo Responsoriale
                        {% elif 'CANTO' in lettura.tipo.upper() %}
                            <i class="fas fa-music"></i> Canto al Vangelo
                        {% elif 'VANGELO' in lettura.tipo.upper() %}
                            <i class="fas fa-book-open"></i> Vangelo
                        {% else %}
                            <i class="fas fa-bookmark"></i> {{ lettura.tipo }}
                        {% endif %}
                    </h5>

                    {% if lettura.riferimento %}
                    <p class="biblia-ref">{{ lettura.riferimento }}</p>
                    {% endif %}

                    <div class="text-section">{{ lettura.testo }}</div>
                    {% endfor %}
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Nessuna lettura disponibile per questa data.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- CSS AGGIUNTIVO PER SALMI -->
<style>
    /* HEADER SALMO MIGLIORATO */
    .salmo-header {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        color: white;
        padding: 1.25rem;
        font-weight: 600;
        font-size: calc(1.05rem * var(--content-font-size));
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .salmo-subtitle {
        opacity: 0.9;
        font-size: calc(0.9rem * var(--content-font-size));
        font-weight: 500;
    }

    /* ANTIFONA - SEPARATA E DISTINTA */
    .antifona-container {
        margin-bottom: 1.75rem;
        padding-bottom: 1.5rem;
        border-bottom: 2px solid var(--neutral-100);
    }

    .antifona-label {
        font-size: calc(0.85rem * var(--content-font-size));
        font-weight: 600;
        color: var(--success);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .antifona {
        background: #f0fdf4;
        padding: 1.25rem;
        border-radius: 8px;
        border-left: 4px solid var(--success);
        font-style: italic;
        color: #059669;
        font-size: calc(0.95rem * var(--content-font-size));
        line-height: 1.7;
    }

    /* TESTO DEL SALMO - CHIARAMENTE SEPARATO */
    .salmo-testo {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        border-left: 4px solid var(--accent);
        margin-bottom: 1.5rem;
        color: var(--neutral-800);
        font-size: calc(0.95rem * var(--content-font-size));
        line-height: 1.8;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    /* GLORIA AL PADRE - STILE FINALE */
    .gloria-patris {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        padding: 1.25rem;
        border-radius: 8px;
        border-left: 4px solid var(--warning);
        text-align: center;
        font-style: italic;
        color: #92400e;
        font-size: calc(0.9rem * var(--content-font-size));
        line-height: 1.8;
        margin-top: 1rem;
    }

    /* CANTICO - CARD SPECIALE */
    .cantico-card {
        background: linear-gradient(135deg, #f0f4ff 0%, #f3e8ff 100%);
        border-top: 3px solid var(--accent);
    }

    .magnificat-subtitle {
        font-style: italic;
        color: var(--accent);
        font-size: calc(1rem * var(--content-font-size));
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        border-left: 4px solid var(--accent);
        font-weight: 500;
    }

    /* RESPONSORIO BREVE */
    .responsorio {
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        border-left-color: var(--success);
        color: #059669;
    }

    /* ORAZIONE */
    .orazione {
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        border-left-color: #dc2626;
        color: #991b1b;
    }

    /* RESPONSIVE PER SALMI */
    @media (max-width: 768px) {
        .salmo-header {
            padding: 1rem;
            font-size: calc(0.95rem * var(--content-font-size));
        }

        .salmo-subtitle {
            width: 100%;
            margin-top: 0.5rem;
        }

        .antifona {
            padding: 1rem;
            font-size: calc(0.9rem * var(--content-font-size));
        }

        .salmo-testo {
            padding: 1rem;
            font-size: calc(0.9rem * var(--content-font-size));
        }

        .gloria-patris {
            padding: 1rem;
            font-size: calc(0.85rem * var(--content-font-size));
        }
    }
</style>

{% endblock %}